---
title: "A Simulation Study"
editor: source
description: |
  A simulation study on maternal investment in frogs
author: Ava Santos-Volpe
date: October 26, 2025
format: 
  html:
    code-fold: true
    code-summary: "Show the code"
execute:
  warning: false
  message: false
---

# Maternal investment in frogs

For this project, I will be looking at the frog dataset from [OpenIntro](https://www.openintro.org/data/index.php?data=frog). This data set is from a study which was trying to understand whether maternal investment changes at varying altitudes on the Tibetan Plateau. The study sought to determine whether reproducing females allocated their energy to egg productions of size or number, which can both influence fitness. 

From February to April 2013, the study team studied various populations of frog who live between 2035 to 3494 m above sea level in the eastern Tibetan Plateau. They located breeding ponds at various altitudes, and at each one, obtained a small sample of freshly laid egg clutches. They counted the number of eggs and weighed the clutch to determine egg weight, and approximated egg size from photographs. The groups I will be looking at will be those above 2,764.5m and those below. I will compare clutch volume. Original data from [Chen et al. (2013)](https://pubmed.ncbi.nlm.nih.gov/24200096/).

```{r}
library(openintro)
library(tidyverse)

frog <- read.csv("/Users/avasantos-volpe/Downloads/frog.csv")
```





```{r}
# create altitude groups
frog2 <- frog |>
  mutate(group = ifelse(altitude>=2764.5, "High", "Low"))
  
# summarize variables
frog_summary <- frog2 |>
  group_by(group) |>
  summarize(avg_clutch = mean(clutch.size),
            med_clutch = median(clutch.size))

# visualize relationship of interest
ggplot(frog2, aes(x = group, y = clutch.size)) +
  geom_boxplot()

# calculate observed statistic
frog_summary |>
  summarize(avg_diff = diff(avg_clutch),
            med_diff = diff(med_clutch))
```
This plot is a visualization of the original data. It shows some differences between the "high" and "low" altitude groups, with a couple of outliers. The median for the "high" group is 691.83 m^3, while the median for the "low" group is 741.31 m^3. The average for the "high" group is 719.69 m^3, while the average for the "low" group is 733.42 m^3.

The following simulation function takes the original data and permutes the clutch sizes among groups. Next, it calculates the difference in means/medians for the original and permuted data. Then, it compares them. Lastly, I mapped my data so that the function would be repeated many times to build a distribution of what differences we would expect by chance. 

```{r}
# generate null sampling distribution
perm_data <- function(rep, data) {
  data |>
    select(group, clutch.size) |>
    mutate(clutch_perm = sample(clutch.size, replace = FALSE)) |>
    group_by(group) |>
    summarize(obs_avg = mean(clutch.size),
              obs_med = median(clutch.size),
              perm_avg = mean(clutch_perm),
              perm_med = median(clutch_perm)) |>
    summarize(obs_avg_diff = diff(obs_avg),
              obs_med_diff = diff(obs_med),
              perm_avg_diff = diff(perm_avg),
              perm_med_diff = diff(perm_med),
              rep = rep)
}

map(c(1:10), perm_data, data = frog2) |>
  list_rbind()

# visualize the null sampling distribution (median)
set.seed(47)
perm_stats <- 
  map(c(1:500), perm_data, data = frog2) |>
  list_rbind()

perm_stats |>
  ggplot(aes(x = perm_avg_diff)) +
  geom_histogram() +
  geom_vline(aes(xintercept = obs_avg_diff), color = "red") +
  labs(
    title = "Difference in average clutch size across altitudes (null distribution)",
    x = "Difference in average clutch size across altitudes (m^3)", 
    y = "Frequency"
  )
```
This plot is the visualization of the null sampling distribution (median). The distribution of differences we would expect if altitude did not affect clutch size.  

```{r}
# calculate p-value
perm_stats |>
  summarize(p_value_avg = mean(perm_avg_diff > obs_avg_diff),
            p_value_med = mean(perm_med_diff > obs_med_diff))
```
From these tests, the observed differences seem to be in line with the distribution of differences in the null sampling distribution. There is no evidence to reject the null hypothesis: the average/median clutch size of frogs does not differ across elevations. So, altitude does not seem to have an effect on clutch size. 